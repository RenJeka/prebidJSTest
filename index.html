<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Prebid Test Page</title>
    <!-- Include Prebid.js library -->
    <script src="//cdn.jsdelivr.net/npm/prebid.js@8.51.0/dist/not-for-prod/prebid.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prebid.js@8.51.0/src/adapters/bidderFactory.js"></script>
    <script src="./advertiseXPrebidAdapter/advertiseXPrebidAdapter.js"></script>
</head>
<body>
<!-- Header -->
<h1>Prebid Test Page</h1>
<!-- Container for ad -->
<div id="ad-div" style="width: 300px; height: 250px;"></div>
<script>
    // Set timeout for bid requests
    const PREBID_TIMEOUT = 1000;

    console.log('AdvertiseXAdapter:', AdvertiseXAdapter);


    // Define ad units
    const adUnits = [{
        code: 'ad-div',
        mediaTypes: {
            banner: {
                sizes: [[300, 250]]
            }
        },
        bids: [{
            bidder: 'AdvertiseX',
            params: {
                adUnitCode: '123456', // Example ad unit code,
                placementId: '12345'
            }
        }]
    }];

    console.log('pbjs:', pbjs);


    // Queue the request to Prebid.js
    pbjs.que.push(function() {
        // Add ad units
        pbjs.addAdUnits(adUnits);
        // Request bids
        pbjs.requestBids({
            timeout: PREBID_TIMEOUT,
            bidsBackHandler: initAdServer
        });
    });

    // Function to handle bid responses
    function initAdServer(bidResponses) {

        console.log('bidResponses:', bidResponses);

        // Iterate over each ad unit response
        Object.keys(bidResponses).forEach(adUnitCode => {
            const adUnitResponse = bidResponses[adUnitCode];
            console.log(`Processing adUnit: ${adUnitCode}`, adUnitResponse);

            if (adUnitResponse.bids && adUnitResponse.bids.length > 0) {
                // Assume rendering the first bid
                const bid = adUnitResponse.bids[0];
                console.log(`Rendering ad for ${adUnitCode} with adId ${bid.adId}`);

                // Find the ad unit container
                const adDiv = document.getElementById(adUnitCode);
                if (adDiv) {
                    // Render the ad
                    pbjs.renderAd(adDiv, bid.adId);
                    // Display ad content
                    adDiv.innerHTML = bid.ad;
                } else {
                    console.error(`Ad unit container not found for ${adUnitCode}`);
                }
            } else {
                console.error(`No valid bids received for ${adUnitCode}`);
            }
        });
    }
</script>
</body>
</html>
